<html>
<head>
  <title>Shortkeys Options</title>
  <script src="zepto.min.js" type="text/javascript"></script>
  <script type="text/javascript">

    // Saves options to localStorage.
    function save_options() {
      var keys = {};
      var i = 0;
      $('input.key').each(function() {
        if ($(this).val() != "") {
          var key = {
            key: $(this).val(),
            action: $(this).next().val()
          }
          keys["key" + i] = key;
        }
        i++;
      })
      console.log(keys);
      localStorage["shortkeys"] = JSON.stringify(keys);
      // Update status to let user know options were saved.
      var status = document.getElementById("status");
      status.innerHTML = "Options Saved.";
      setTimeout(function() {
        status.innerHTML = "";
      }, 3000);
    }

    // Restores select box state to saved value from localStorage.
    function restore_options() {
      var oldkeys = localStorage["shortkeys"];
      oldkeys = JSON.parse(oldkeys);
      if (!oldkeys) {
        return;
      }
      i = 1;
      while (oldkeys["key" + i] !== undefined) {
        key = oldkeys["key" + i];
        console.log(oldkeys["key" + i]);
        newinputs = $('.hide').clone();
        newinputs.removeClass('hide').insertBefore('button');
        newinputs.children('input').val(key.key);
        newinputs.children('select').val(key.action);
        i++;
      }
    }

  </script>

  <style type="text/css">
    .hide {
      display: none;
    }
  </style>
</head>

<body onload="restore_options()">
  <div id="status"></div>

  <div class="hide">
    <input class="key" placeholder="Key combo" type="text" />
    <select class="action">
      <option value="topofpage">Scroll to top</option>
      <option value="bottomofpage">Scroll to bottom</option>
      <option value="back">Go back</option>
      <option value="forward">Go forward</option>
    </select>
  </div>

  <button onclick="save_options()">Save</button>

</body>
</html>
