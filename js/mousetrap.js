window.Mousetrap=(function(){var g={'backspace':8,'tab':9,'enter':13,'return':13,'shift':16,'ctrl':17,'alt':18,'option':18,'capslock':20,'esc':27,'escape':27,'space':32,'pageup':33,'pagedown':34,'end':35,'home':36,'left':37,'up':38,'right':39,'down':40,'del':46,'meta':91,'command':91,';':186,'=':187,',':188,'-':189,'.':190,'/':191,'`':192,'[':219,'\\':220,']':221,'\'':222},_SHIFT_MAP={'~':'`','!':'1','@':'2','#':'3','$':'4','%':'5','^':'6','&':'7','*':'8','(':'9',')':'0','_':'-','+':'=',':':';','\"':'\'','<':',','>':'.','?':'/','|':'\\'},_callbacks={},_direct_map={},_sequence_levels={},_reset_timer,_ignore_next_keyup=false,_inside_sequence=false;for(var i=1;i<20;++i){g['f'+i]=111+i}function _addEvent(a,b,c){if(a.addEventListener){return a.addEventListener(b,c,false)}a.attachEvent('on'+b,c)}function _keyCodeFromEvent(e){var a=typeof e.which=="number"?e.which:e.keyCode;if(a==93||a==224){return 91}if(a>=96&&a<=105){return a-48}return a}function _stop(e){var a=e.target||e.srcElement,tag_name=a.tagName;if((' '+a.className+' ').indexOf(' mousetrap ')>-1){return false}return tag_name=='INPUT'||tag_name=='SELECT'||tag_name=='TEXTAREA'||a.getAttribute('contenteditable')}function _modifiersMatch(a,b){return a.sort().join(',')===b.sort().join(',')}function _resetSequences(a){a=a||{};var b=false;for(var c in _sequence_levels){if(!a[c]){_sequence_levels[c]=0;continue}b=true}if(!b){_inside_sequence=false}}function _getMatches(a,b,c,d){var i,callback,matches=[];if(!_callbacks[a]){return[]}if(c=='keyup'&&_isModifier(a)){b=[a]}for(i=0;i<_callbacks[a].length;++i){callback=_callbacks[a][i];if(callback['seq']&&_sequence_levels[callback['seq']]!=callback['level']){continue}if(c==callback.action&&_modifiersMatch(b,callback.modifiers)){if(d){_callbacks[a].splice(i,1)}matches.push(callback)}}return matches}function _eventModifiers(e){var a=[];if(e.shiftKey){a.push(g.shift)}if(e.altKey){a.push(g.alt)}if(e.ctrlKey){a.push(g.ctrl)}if(e.metaKey){a.push(g.command)}return a}function _fireCallback(a,b,e){if(_stop(e)){return}var c=_getMatches(a,_eventModifiers(e),b),i,do_not_reset={},processed_sequence_callback=false;for(i=0;i<c.length;++i){if(c[i]['seq']){processed_sequence_callback=true;do_not_reset[c[i]['seq']]=1;c[i].callback(e);continue}if(!processed_sequence_callback&&!_inside_sequence){c[i].callback(e);break}}if(b==_inside_sequence&&!_isModifier(a)){_resetSequences(do_not_reset)}}function _handleKeyDown(e){_fireCallback(_keyCodeFromEvent(e),'keydown',e)}function _handleKeyUp(e){if(_ignore_next_keyup===e.keyCode){_ignore_next_keyup=false;return}_fireCallback(_keyCodeFromEvent(e),'keyup',e)}function _isModifier(a){return(a>15&&a<19)||a==91}function _resetSequence(){clearTimeout(_reset_timer);_reset_timer=setTimeout(_resetSequences,1000)}function _bindSequence(a,b,c,d){_sequence_levels[a]=0;var f=function(e){_inside_sequence=d;++_sequence_levels[a];_resetSequence()},_callbackAndReset=function(e){c(e);if(d==='keydown'){_ignore_next_keyup=e.keyCode}setTimeout(_resetSequences,10)},i;for(i=0;i<b.length;++i){_bindSingle(b[i],i<b.length-1?f:_callbackAndReset,d,a,i)}}function _bindSingle(a,b,c,d,e){a=a.replace(/\s+/g,' ');var f=a.split(' '),i,key,keys,modifiers=[];if(f.length>1){return _bindSequence(a,f,b,c)}keys=a==='+'?['+']:a.split('+');for(i=0;i<keys.length;++i){key=keys[i];if(_SHIFT_MAP[key]){modifiers.push(g.shift);key=_SHIFT_MAP[key]}key=g[key]||key.toUpperCase().charCodeAt(0);if(_isModifier(key)){modifiers.push(key)}}if(!_callbacks[key]){_callbacks[key]=[]}_getMatches(key,modifiers,c,!!!d);_callbacks[key][d?'unshift':'push']({callback:b,modifiers:modifiers,action:c,seq:d,level:e})}function _bindMultiple(a,b,c){for(var i=0;i<a.length;++i){_bindSingle(a[i],b,c)}}_addEvent(document,'keydown',_handleKeyDown);_addEvent(document,'keyup',_handleKeyUp);return{bind:function(a,b,c){c=c||'keydown';_bindMultiple(a instanceof Array?a:a.split(','),b,c);_direct_map[a+':'+c]=b},trigger:function(a,b){_direct_map[a+':'+(b||'keydown')]()},reset:function(){_callbacks={};_direct_map={}}}})();
